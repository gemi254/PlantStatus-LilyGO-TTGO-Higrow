//SVG icons used
PROGMEM const char HTML_PAGE_SVG_SUN[] = R"=====(
              <svg id="sun" width="40px" height="40px" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"></path>
              </g>
              </svg>
)=====";
PROGMEM const char HTML_PAGE_SVG_THERMOMETER[] = R"=====(
              <svg id="thermometer" width="40px" height="40px" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M15 13V5A3 3 0 0 0 9 5V13A5 5 0 1 0 15 13M12 4A1 1 0 0 1 13 5V8H11V5A1 1 0 0 1 12 4Z"></path>
              </g>
              </svg>
)=====";
PROGMEM const char HTML_PAGE_SVG_RAIN[] = R"=====(
              <svg id="rain" width="40px" height="40px" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M6,14.03A1,1 0 0,1 7,15.03C7,15.58 6.55,16.03 6,16.03C3.24,16.03 1,13.79 1,11.03C1,8.27 3.24,6.03 6,6.03C7,3.68 9.3,2.03 12,2.03C15.43,2.03 18.24,4.69 18.5,8.06L19,8.03A4,4 0 0,1 23,12.03C23,14.23 21.21,16.03 19,16.03H18C17.45,16.03 17,15.58 17,15.03C17,14.47 17.45,14.03 18,14.03H19A2,2 0 0,0 21,12.03A2,2 0 0,0 19,10.03H17V9.03C17,6.27 14.76,4.03 12,4.03C9.5,4.03 7.45,5.84 7.06,8.21C6.73,8.09 6.37,8.03 6,8.03A3,3 0 0,0 3,11.03A3,3 0 0,0 6,14.03M12,14.15C12.18,14.39 12.37,14.66 12.56,14.94C13,15.56 14,17.03 14,18C14,19.11 13.1,20 12,20A2,2 0 0,1 10,18C10,17.03 11,15.56 11.44,14.94C11.63,14.66 11.82,14.4 12,14.15M12,11.03L11.5,11.59C11.5,11.59 10.65,12.55 9.79,13.81C8.93,15.06 8,16.56 8,18A4,4 0 0,0 12,22A4,4 0 0,0 16,18C16,16.56 15.07,15.06 14.21,13.81C13.35,12.55 12.5,11.59 12.5,11.59"></path>
              </g>
              </svg>
)=====";
PROGMEM const char HTML_PAGE_SVG_PERC_DROP[] = R"=====(
             <svg id="perc_drop"width="40px" height="40px" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M12,3.25C12,3.25 6,10 6,14C6,17.32 8.69,20 12,20A6,6 0 0,0 18,14C18,10 12,3.25 12,3.25M14.47,9.97L15.53,11.03L9.53,17.03L8.47,15.97M9.75,10A1.25,1.25 0 0,1 11,11.25A1.25,1.25 0 0,1 9.75,12.5A1.25,1.25 0 0,1 8.5,11.25A1.25,1.25 0 0,1 9.75,10M14.25,14.5A1.25,1.25 0 0,1 15.5,15.75A1.25,1.25 0 0,1 14.25,17A1.25,1.25 0 0,1 13,15.75A1.25,1.25 0 0,1 14.25,14.5Z"></path>
              </g>
              </svg>
)=====";
PROGMEM const char HTML_PAGE_SVG_EYE[] = R"=====(
              <svg id="eye" width="40px" height="40px" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"></path>
              </g>
              </svg>
)=====";
PROGMEM const char HTML_PAGE_SVG_CLOCK[] = R"=====(
              <svg width="40px" height="40px" id="clock" preserveAspectRatio="xMidYMid meet" focusable="false" role="img" aria-hidden="true" viewBox="0 0 24 24">
              <g>
                <path fill="lightskyblue" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"></path>
              </g>
              </svg>
)=====";

PROGMEM const char HTML_PAGE_SVG_FOLDER[] = R"=====(
<svg class="icon" width="18px" height="18px" viewBox="0 0 48 48">
    <path style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal" d="M 5 4 C 3.3544268 4 2 5.3555411 2 7 L 2 16 L 2 26 L 2 43 C 2 44.644459 3.3544268 46 5 46 L 45 46 C 46.645063 46 48 44.645063 48 43 L 48 26 L 48 16 L 48 11 C 48 9.3549372 46.645063 8 45 8 L 18 8 C 18.08657 8 17.96899 8.000364 17.724609 7.71875 C 17.480227 7.437136 17.179419 6.9699412 16.865234 6.46875 C 16.55105 5.9675588 16.221777 5.4327899 15.806641 4.9628906 C 15.391504 4.4929914 14.818754 4 14 4 L 5 4 z M 5 6 L 14 6 C 13.93925 6 14.06114 6.00701 14.308594 6.2871094 C 14.556051 6.5672101 14.857231 7.0324412 15.169922 7.53125 C 15.482613 8.0300588 15.806429 8.562864 16.212891 9.03125 C 16.619352 9.499636 17.178927 10 18 10 L 45 10 C 45.562937 10 46 10.437063 46 11 L 46 13.1875 C 45.685108 13.07394 45.351843 13 45 13 L 5 13 C 4.6481575 13 4.3148915 13.07394 4 13.1875 L 4 7 C 4 6.4364589 4.4355732 6 5 6 z M 5 15 L 45 15 C 45.56503 15 46 15.43497 46 16 L 46 26 L 46 43 C 46 43.562937 45.562937 44 45 44 L 5 44 C 4.4355732 44 4 43.563541 4 43 L 4 26 L 4 16 C 4 15.43497 4.4349698 15 5 15 z" color="#000" font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"/>
</svg>
)=====";

// Download icon
PROGMEM const char HTML_PAGE_SVG_DOWNLOAD[] = R"=====(
<svg class="icon" width="18px" height="18px" viewBox="0 0 16 16">
    <path style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal" d="M 7 2 L 7 9.2929688 L 4.3535156 6.6464844 L 3.6464844 7.3535156 L 7.5 11.207031 L 11.353516 7.3535156 L 10.646484 6.6464844 L 8 9.2929688 L 8 2 L 7 2 z M 3 13 L 3 14 L 3.5 14 L 11.5 14 L 12 14 L 12 13 L 11.5 13 L 3.5 13 L 3 13 z" font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"/>
</svg>
)=====";
// Delete icon
PROGMEM const char HTML_PAGE_SVG_RECYCLE[] = R"=====(
<svg class="icon" width="18px" height="18px" viewBox="0 0 16 16">
    <path d="M 8 1.0078125 C 7.4059332 1.0078125 6.8120113 1.2861012 6.4609375 1.8417969 L 4.703125 4.6074219 L 5.546875 5.1425781 L 7.3046875 2.375 L 7.3066406 2.375 C 7.6304931 1.8623914 8.3695069 1.8623914 8.6933594 2.375 L 8.6992188 2.3828125 L 10.664062 5.2265625 L 9.125 6.5292969 L 13 7 L 13 3.25 L 11.431641 4.578125 L 9.5390625 1.8417969 C 9.1879887 1.2861012 8.5940668 1.0078125 8 1.0078125 z M 5 6 L 1.1542969 6.6835938 L 2.6484375 7.875 L 1.3027344 10.001953 C 0.48952535 11.288542 1.4732671 13 3 13 L 6 13 L 6 12 L 3 12 C 2.1907329 12 1.7316465 11.19652 2.1484375 10.537109 L 3.4355469 8.5019531 L 5 9.75 L 5 6 z M 13.351562 7.7441406 L 12.492188 8.2558594 L 13.849609 10.53125 L 13.851562 10.537109 C 14.269434 11.19823 13.817652 11.998047 13.007812 11.998047 L 10 11.998047 L 10 10 L 7 12.5 L 10 15 L 10 12.998047 L 13.007812 12.998047 C 14.533976 12.998047 15.509394 11.286832 14.697266 10.001953 L 13.351562 7.7441406 z"/>
</svg>
)=====";
// Flower icon
PROGMEM const char HTML_PAGE_SVG_FLOWER[] = R"=====(
<svg class="icon" width="18px" height="18px" viewBox="0 0 16 16">
<path style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal" d="M 2.5 2 C 1.6774686 2 1 2.6774686 1 3.5 L 1 4 L 1 5 L 1 12.5 C 1 13.322531 1.6774686 14 2.5 14 L 13.5 14 C 14.322531 14 15 13.322531 15 12.5 L 15 5.5 C 15 4.6774686 14.322531 4 13.5 4 L 6.7988281 4 L 6.1445312 2.7871094 C 5.8835911 2.3027204 5.3751898 2 4.8242188 2 L 2.5 2 z M 2.5 3 L 4.8242188 3 C 5.0092476 3 5.176612 3.1001077 5.2636719 3.2617188 L 5.6621094 4 L 2 4 L 2 3.5 C 2 3.2185314 2.2185314 3 2.5 3 z M 2 5 L 7.3378906 5 L 13.5 5 C 13.781469 5 14 5.2185314 14 5.5 L 14 12.5 C 14 12.781469 13.781469 13 13.5 13 L 2.5 13 C 2.2185314 13 2 12.781469 2 12.5 L 2 5 z" font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"/>
</svg>
)=====";

// Template for header, begin of the config form
PROGMEM const char HTML_PAGE_HOME_START[] = 
R"=====(<!DOCTYPE HTML>
<html lang='en'>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>{page_title}</title>)=====";

PROGMEM const char HTML_PAGE_HOME_CSS[] = 
R"=====(
<style>
:root {
 --caption: cornflowerblue;
}
.column .card.closed {
  height: 28px;
}
.card-key {
	text-align: right;
  width: auto;
  color: lightslategray;
}
.card-val {
	width: auto;
	font-weight: 800;
  color: midnightblue;
  font-size: 1.2em;
}
.card-icon {
	width: 70px;
}
.icon:hover {
  fill: cadetblue;
}
</style>)=====";

//Scripts to handle websockets
PROGMEM const char HTML_PAGE_HOME_SCRIPT[] = R"=====(
<script>
/*********** WebSockets functions ***********/
const wsServer = "ws://" + document.location.host + ":81/";
let ws = null;
let hbTimer = null;
let refreshInterval = 10000;
document.addEventListener('DOMContentLoaded', initWebSocket());

// close web socket on leaving page
window.addEventListener('beforeunload', function (event) {
     if (ws) closeWS();
}); 

// define websocket handling
function initWebSocket() {  
  console.log("Connect to: " + wsServer);
  ws = new WebSocket(wsServer);
  ws.onopen = onOpen;
  ws.onclose = onClose;
  ws.onmessage = onMessage; 
  ws.onerror = onError;
}
async function closeWS() {
  ws.send('K');
  await sleep(500);
  ws.close();
}
function sendCmd(reqStr) {
  ws.send(reqStr);
  console.log("Cmd: " + reqStr);
}

// periodically check that connection is still up and get status
function heartbeat() {
  if (!ws) return;
  if (ws.readyState !== 1) return;
  sendCmd("H");
  clearTimeout(hbTimer);
  hbTimer = setTimeout(heartbeat, refreshInterval);
}

// connect to websocket server
function onOpen(event) {
  console.log("Connected");
  heartbeat();
}

// process received WS message
function onMessage(messageEvent) {
  if (messageEvent.data.startsWith("{")) {
    // json data
    updateData = JSON.parse(messageEvent.data);
    updateTable(updateData); // format received config json into html table
  } else {
    console.log(messageEvent.data);
  }

  if(hbTimer){
    clearTimeout(hbTimer);
    hbTimer = setTimeout(heartbeat, refreshInterval);
  }
}

function updateTable(configData){
  Object.entries(configData).forEach(([key, value]) => {    
    const td = document.getElementById(key)
    if(td){
      if(key!="time" && key!="batChargeDate" && key!="onPower" && key!="sleepReason"){
        const inc = document.getElementById(key+"_inc");
        if(td.innerHTML == value) inc.innerHTML = "";
        else if(td.innerHTML < value) { inc.style.color="lightgreen"; inc.innerHTML = "▲"; }
        else { inc.style.color="lightcoral"; inc.innerHTML = "▼"; }
      }
      td.innerHTML = value;
    } 
  });
}

function onError(event) {
  console.log("WS Error: " + event.code);
}

function onClose(event) {
  console.log("Disconnected: " + event.code + ' - ' + event.reason);
  ws = null;
  // event.codes:
  //   1006 if server not available, or another web page is already open
  //   1005 if closed from app
  if (event.code == 1006) {} //alert("Closed websocket as a newer connection was made, refresh browser page");
  else if (event.code != 1005) initWebSocket(); // retry if any other reason
}
</script>  )=====";

// Template for simple page body
PROGMEM const char HTML_PAGE_SIMPLE_BODY[] = R"=====(
</head>
<body>
<div class="container">
  <div class="row" style="min-width: 50%;">
    <div class="column">
      <div class="card">
)=====";

// Template for simple page body end
PROGMEM const char HTML_PAGE_SIMPLE_BODY_END[] = R"=====(
      </div>
    </div>
  </div>
</div>
</body>
</html>
)=====";

// Template html body
PROGMEM const char HTML_PAGE_HOME_BODY[] = R"=====(
</head>
<body>
<div class="container">
  <div class="row">
    <div class="column">
      <div class="card">
        <h3><font style="color: darkblue;">{host_name}</font> status</h3>
      </div>
      <div class="card">
        <table>
          <h2><font style="color: mediumblue;">{plant_name}</font> sensors</h2>
)=====";

// Template for one line
PROGMEM const char HTML_PAGE_HOME_LINE[] = R"=====(
          <tr>
            <td class="card-icon">{svg}</td>
            <td class="card-key">{name}</td>
            <td class="card-val"><span id="{key}">{val}</span>&nbsp;<font color='lightskyblue'>{units}</font>&nbsp;<span id="{key}_inc"></span></td>
          </tr>
)=====";

//Seperator
PROGMEM const char HTML_PAGE_HOME_SEP[] = R"=====(
        </table> 
      </div>
      <div class="card closed" onClick="this.classList.toggle('closed')">
        <h2>Device Information</h2>
        <table>     
)=====";
PROGMEM const char HTML_PAGE_HOME_BUTTON_VIEWLOG[] = R"=====(
  <button title='View debug log' onClick="window.open('/cmd?view={log}', '_blank');">Debug log</button>
)=====";
PROGMEM const char HTML_PAGE_HOME_BUTTON_RESETLOG[] = R"=====(
  <button title='Reset debug log file. All data will be lost.' onClick="window.location.href ='/cmd?resetLog={log}';">Remove log</button>
)=====";
// Template for page end
PROGMEM const char HTML_PAGE_HOME_END[] = R"=====(
      </table>
      </div>
      <div class="card">
        <button title='View sensors hourly log' onClick="window.open('/cmd?view=', '_blank');">Hourly</button>
        <button title='View sensors daily logs' onClick='window.location.href="/fs?dir=/data"'>Daily</button>
        <button title='Configure this device' onClick='window.location.href="/cfg"'>Configure</button>
        <button title='Reboot device' onClick='if(!confirm("Reboot esp?")) return false; else window.location.href="/cmd?reboot=1;"'>Reboot</button>
        <button title='Send device mqtt discovery messages to Homeassistant' onClick='window.location.href="/cmd?hasDiscovery=1"'>Discovery</button>
        <button title='Reset to factory defaults. All data will be lost!' onClick='if(!confirm("Reset to factory defaults? All data will be lost!")) return false; else window.location.href="/cmd?reset=1"'>Defaults</button>
        <!--Custom-->
      </div>
    </div>
  </br>
  <center><small style="color: lightgray;">PlantStatus Ver: {appVer}</small></center>
  </div>
</div>
</body>
</html>
)=====";

//Back link
PROGMEM const char HTML_BACK_BUTTON[] = R"~(
<button type='button' onClick="window.history.go(-1); return false;">Back</button>
)~";
//Home button
PROGMEM const char HTML_HOME_BUTTON[] = R"~(
<button type='button' title='Return to home page' onClick='window.location.href="/"' name='Home'>Home</button>
)~";


// Ping script
PROGMEM const char HTML_PING_SCRIPT[] = R"~(
<script>
function ping(){
  const Http = new XMLHttpRequest();
  const url='/pg';
  Http.open("GET", url);
  Http.send();
}
setInterval(ping, 10000);
</script>
)~";